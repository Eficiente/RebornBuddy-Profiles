<?xml version="1.0" encoding="utf-8"?>
<!--
Profile: [O] I Can Dig It I
Author: y2krazy
Version: 1.0.0
Required Level: 40
Required Teleport Location:
	Camp Drybone
	Wineport
Required User Interaction:
	This profile should be AFKable.
Required Setup:
	Acquire Camp Drybone and Wineport Aetherytes
	Set Gear Set #1 to your preferred combat class.
	Set Gear Set #11 to Botanist.
	ONLY run once per day - you can only get 1 map every 18 hours.
Item Drops:
	Timeworn Leather Map
	Water Shard
	Leather Treasure Map Rewards (Not Yet Implemented)
-->

<!--User Configuration-->
<!DOCTYPE Profile [
  <!ENTITY TreasureComplete "&quot;You defeat all the enemies drawn by the trap&quot;">
  <!--Change to your localized text for your client-->
]>
<!--End User Configuration-->

<Profile>
	<Name>[O] I Can Dig It I</Name>
	<KillRadius>90</KillRadius>
	<GrindAreas>
		<GrindArea name="Outer_La_Noscea">
			<Hotspots>
				<Hotspot Radius="90" XYZ="-365.1482, 51.7397, -266.5685" name="Treasure Chest Mobs" />
			</Hotspots>
			<TargetMobs>
				<TargetMob Id="2381" />
				<TargetMob Id="2382" />
				<TargetMob Id="2383" />
			</TargetMobs>
			<MinLevel>1</MinLevel>
			<MaxLevel>61</MaxLevel>
		</GrindArea>
	</GrindAreas>
	<Order>
		<BotSettings AutoEquip="1" />

		<!-- Timeworn Leather Map -->

		<!-- To Do: Possible to Check if an Achievement is Complete? -->

		<!-- To Do: Possible to Check if the 18 Hour Timer is Active? -->

		<If Condition="not HasAtLeast(2001087,1)">

			<If Condition="(ItemCount(6690) &lt; 1)">

				<RunCode Name="Botanist" />

				<If Condition="not IsOnMap(137)">
					<TeleportTo Name="Wineport" AetheryteId="12" />
				</If>

				<MoveTo Name="Farming Area" XYZ="-89.76852, 41.5017, 196.8747">
				<Dismount />
				<RunCode Name="BotanistStealth" />
				<RunCode Name="DisableMount" />

			    <Gather while="(ItemCount(6688) &lt; 1)">
					<GatherObject>Mature Tree</GatherObject>
					<HotSpots>
						<HotSpot Radius="90" XYZ="-89.76852, 41.5017, 196.8747" name="Mature Tree" />
						<HotSpot Radius="90" XYZ="-161.6942, 47.04554, 174.3023" name="Mature Tree" />
					</HotSpots>
					<ItemNames>
						<ItemName>Timeworn Leather Map</ItemName>
						<ItemName>Water Shard</ItemName>
					</ItemNames>
			  	</Gather>

			</If>

		  	<If Condition="(ItemCount(6688) &gt; 0)">
		  		
		  		<LogMessage Message="You've found your daily treasure map!" />
		  		<LogMessage Message="Opening the map is not yet supported." />
		  		<LogMessage Message="Please Decipher your map, then re-run this profile." />

		  		<!-- To Do: Open the Bottle -->

		  		<!-- <UseItem ItemId="6690" XYZ="85.05799, 21.02174, 158.1695" /> -->

				<!-- <If Condition="not IsOnMap(147)">
					<TeleportTo Name="Camp Bluefog" AetheryteId="21" />
				</If>

				<WaitTimer WaitTime="5" />
				<MoveTo Name="Farming Area" XYZ="85.05799, 21.02174, 158.1695" />
				<Dismount />
				<WaitTimer WaitTime="1" />
		  		<UseSpell SpellId="1694" NpcId="6690" XYZ="85.05799, 21.02174, 158.1695" />
		  		<WaitTimer WaitTime="3" />
				<LogMessage Message="You've found your daily treasure map!" /> -->

			</If>

		</If>

		<!-- Leather Treasure Chest -->

		<If Condition="HasAtLeast(2001087,1)">

			<LogMessage Message="Let's go find your daily treasure!" />
			<RunCode Name="Combat" />

			<!-- To Do: Possible to Check for Treasure Map Location? -->

			<!-- Outer La Noscea (3 Waves) -->

			<If Condition="not IsOnMap(180)">
				<TeleportTo Name="Camp Overlook" AetheryteId="16" />
			</If>

			<MoveTo Name="Dig Area" XYZ="-365.1482, 51.7397, -266.5685" />
			<Dismount />
			<UseSpell SpellID="1695" XYZ="-365.1482, 51.7397, -266.5685" />
			<WaitTimer WaitTime="5" />

			<!-- To Do: Check for Treasure Coffer Spawn -->

			<If Condition="not ff14bot.ManagersChatLogEntry.Contents.Contains(&TreasureComplete;)">
				<YesUseObject NpcId="2896" XYZ="-365.1482, 51.7397, -266.5685" />
				<Grind grindRef="Outer_La_Noscea" while="not ff14bot.ManagersChatLogEntry.Contents.Contains(&TreasureComplete;)" />
				<WaitTimer WaitTime="5" />
				
				<If Condition="GameObjectManager.GetObjectByNPCId(2896)">
					<UseObject NpcId="2896" XYZ="-365.1482, 51.7397, -266.5685" />
				</If>

				<WaitTimer WaitTime="5" />
				
				<If Condition="not HasAtLeast(2001089,1)">
					<LogMessage Message="Your treasure is in your bags." />
					<LogMessage Message="Check back again tomorrow for more treasure!" />
					<StopBot />
				</If>
			<!-- </If> -->

			<!-- To Do: Other Areas -->

		</If>

        <StopBot />

	</Order>
	<CodeChunks>
		<CodeChunk Name="Combat">
			<![CDATA[
				ff14bot.Managers.ChatManager.SendChat("/gs change 1");
			]]>
		</CodeChunk>
		<CodeChunk Name="Botanist">
			<![CDATA[
				ff14bot.Managers.ChatManager.SendChat("/gs change 11");
			]]>
		</CodeChunk>
		<CodeChunk Name="BotanistStealth">
		<![CDATA[
			SpellData data;
			if (!Core.Me.HasAura(47) && Actionmanager.CurrentActions.TryGetValue(212, out data) && Actionmanager.CanCast(data, Core.Me)) Actionmanager.DoAction(212, Core.Me);
		]]>
		</CodeChunk>
		<CodeChunk Name="DisableMount">
		<![CDATA[
			ff14bot.Settings.CharacterSettings.Instance.UseMount = false;
		]]>
		</CodeChunk>
		<CodeChunk Name="EnableMount">
		<![CDATA[
			ff14bot.Settings.CharacterSettings.Instance.UseMount = true;
		]]>
		</CodeChunk>
	</CodeChunks>
</Profile>
