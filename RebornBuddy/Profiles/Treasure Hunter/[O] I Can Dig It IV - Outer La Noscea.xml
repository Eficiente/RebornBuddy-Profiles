<?xml version="1.0" encoding="utf-8"?>
<!--
Profile: [O] I Can Dig It IV
Author: y2krazy
Version: 1.0.0
Required Level: 50
Required Teleport Location:
	Camp Bluefog
	Camp Drybone
Required User Interaction:
	This profile should be AFKable.
Required Setup:
	Acquire Camp Bluefog and Camp Drybone Aetherytes
	Set Gear Set #1 to your preferred combat class.
	Set Gear Set #10 to Miner.
	ONLY run once per day - you can only get 1 map every 18 hours.
Supported Maps:
	Eastern Thanalan
Item Drops:
	Timeworn Boarskin Map
	 Shard
	Boarskin Treasure Map Rewards
-->

<!--User Configuration-->
<!DOCTYPE Profile [
  <!ENTITY TreasureComplete "&quot;You defeat all the enemies drawn by the trap&quot;">
  <!--Change to your localized text for your client-->
]>
<!--End User Configuration-->

<Profile>
	<Name>[O] I Can Dig It IV</Name>
	<KillRadius>90</KillRadius>
	<GrindAreas>
		<GrindArea name="Coerthas_Central_Highlands">
			<Hotspots>
				<Hotspot Radius="90" XYZ="461.6874, 306.0154, -286.4336" name="Treasure Chest Mobs" />
			</Hotspots>
			<TargetMobs>
				<TargetMob Id="2425" />
				<TargetMob Id="2426" />
				<TargetMob Id="2427" />
			</TargetMobs>
			<MinLevel>1</MinLevel>
			<MaxLevel>61</MaxLevel>
		</GrindArea>
	</GrindAreas>
	<Order>

		<!-- Timeworn Boarskin Map -->

		<!-- To Do: Possible to Check if an Achievement is Complete? -->

		<!-- To Do: Possible to Check if the 18 Hour Timer is Active? -->

		<If Condition="not HasAtLeast(2001090,1)">

			<If Condition="(ItemCount(6691) &lt; 1)">

				<RunCode Name="Botanist" />

				<If Condition="not IsOnMap(134)">
					<TeleportTo Name="Summerford Farms" AetheryteId="52" />
				</If>

				<MoveTo Name="Farming Area" XYZ="85.05799, 21.02174, 158.1695" />
				<Dismount />
				<RunCode Name="BotanistStealth" />
				<RunCode Name="DisableMount" />

			    <Gather while="(ItemCount(6691) &lt; 1)">
					<GatherObject>Mature Tree</GatherObject>
					<HotSpots>
						<HotSpot Radius="90" XYZ="-36.3604, 46.03748, -16.20107" name="Mature Tree" />
						<HotSpot Radius="90" XYZ="-90.4474, 41.10585, 5.501242" name="Mature Tree" />
					</HotSpots>
					<ItemNames>
						<ItemName>Timeworn Toadskin Map</ItemName>
						<ItemName>Fire Shard</ItemName>
					</ItemNames>
			  	</Gather>

			  	<RunCode Name="EnableMount" />

			</If>

		  	<If Condition="(ItemCount(6691) &gt; 0)">
		  		
		  		<LogMessage Message="You've found your daily treasure map!" />
		  		<LogMessage Message="Opening the map is not yet supported." />
		  		<LogMessage Message="Please Decipher your map, then re-run this profile." />

		  		<!-- To Do: Open the Bottle -->

		  		<!-- <UseItem ItemId="6691" XYZ="85.05799, 21.02174, 158.1695" /> -->

				<!-- <If Condition="not IsOnMap(147)">
					<TeleportTo Name="Camp Bluefog" AetheryteId="21" />
				</If>

				<WaitTimer WaitTime="5" />
				<MoveTo Name="Farming Area" XYZ="85.05799, 21.02174, 158.1695" />
				<Dismount />
				<WaitTimer WaitTime="1" />
		  		<UseSpell SpellId="1694" NpcId="6691" XYZ="85.05799, 21.02174, 158.1695" />
		  		<WaitTimer WaitTime="3" />
				<LogMessage Message="You've found your daily treasure map!" /> -->

			</If>
			
		</If>

		<!-- Toadskin Treasure Chest -->

		<If Condition="HasAtLeast(2001090,1)">

			<LogMessage Message="Let's go find your daily treasure!" />
			<RunCode Name="Combat" />

			<!-- To Do: Possible to Check for Treasure Map Location? -->

			<!-- Outer La Noscea (3 Waves) -->

			<If Condition="not IsOnMap(180)">
				<TeleportTo Name="Camp Overlook" AetheryteId="16" />
			</If>

			<MoveTo Name="Dig Area" XYZ="191.8131, 63.62408, -276.8129" />
			<Dismount />
			<UseSpell SpellID="1695" XYZ="191.8131, 63.62408, -276.8129" />
			<WaitTimer WaitTime="5" />

			<!-- To Do: Check for Treasure Coffer Spawn -->

			<!-- <If Condition="GameObjectManager.GetObjectByNPCId(2896)"> -->
				<YesUseObject NpcId="2896" XYZ="191.8131, 63.62408, -276.8129" />
				<Grind grindRef="Outer_La_Noscea" while="not ff14bot.ManagersChatLogEntry.Contents.Contains(&TreasureComplete;)" />
				<WaitTimer WaitTime="5" />
				
				<If Condition="GameObjectManager.GetObjectByNPCId(2896)">
					<UseObject NpcId="2896" XYZ="191.8131, 63.62408, -276.8129" />
				</If>

				<WaitTimer WaitTime="5" />
				
				<If Condition="not HasAtLeast(2001090,1)">
					<LogMessage Message="Your treasure is in your bags." />
					<LogMessage Message="Check back again tomorrow for more treasure!" />
					<StopBot />
				</If>
			<!-- </If> -->

			<!-- To Do: Other Areas -->

		</If>

		<LogMessage Message="Check back again tomorrow for more treasure!" />
        <StopBot />

	</Order>
	<CodeChunks>
		<CodeChunk Name="Combat">
			<![CDATA[
				ff14bot.Managers.ChatManager.SendChat("/gs change 1");
			]]>
		</CodeChunk>
		<CodeChunk Name="Botanist">
			<![CDATA[
				ff14bot.Managers.ChatManager.SendChat("/gs change 11");
			]]>
		</CodeChunk>
		<CodeChunk Name="BotanistStealth">
		<![CDATA[
			SpellData data;
			if (!Core.Me.HasAura(47) && Actionmanager.CurrentActions.TryGetValue(212, out data) && Actionmanager.CanCast(data, Core.Me)) Actionmanager.DoAction(212, Core.Me);
		]]>
		</CodeChunk>
		<CodeChunk Name="DisableMount">
		<![CDATA[
			ff14bot.Settings.CharacterSettings.Instance.UseMount = false;
		]]>
		</CodeChunk>
		<CodeChunk Name="EnableMount">
		<![CDATA[
			ff14bot.Settings.CharacterSettings.Instance.UseMount = true;
		]]>
		</CodeChunk>
	</CodeChunks>
</Profile>
